<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>云音乐播放器</title>
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.2);
        }

        body {
            margin: 0;
            padding: 20px;
            background: url('https://picsum.photos/1920/1080') fixed;
            background-size: cover;
            font-family: 'Microsoft YaHei', sans-serif;
            min-height: 100vh;
        }

        .container {
            backdrop-filter: blur(10px);
            background: var(--glass-bg);
            border-radius: 15px;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }

        /* 搜索区域 */
        #searchResults {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .song-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
        }

        .song-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* 歌词区域 */
        #lyricsContainer {
            height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            color: white;
            line-height: 2;
        }

        .lyric-line {
            transition: all 0.3s;
        }

        .current-lyric {
            color: #00b4ff;
            font-weight: bold;
            transform: scale(1.05);
        }

        /* 播放列表 */
        .playlist-container {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
        }

        #playlist {
            max-height: 200px;
            overflow-y: auto;
        }

        .playlist-item {
            padding: 8px;
            border-radius: 5px;
            margin: 3px 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .current-song {
            background: rgba(0, 180, 255, 0.3) !important;
            font-weight: bold;
        }

        /* 控制按钮 */
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .control-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 20px;
            background: rgba(0, 180, 255, 0.8);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: #00b4ff;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.8);
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <input type="text" id="searchInput" placeholder="搜索歌曲...">
        <ul id="searchResults"></ul>
        <div id="lyricsContainer"></div>
        <audio id="audioPlayer" controls></audio>

        <!-- 播放列表区域 -->
        <div class="playlist-container">
            <h3 style="color: white; margin-top: 0;">播放列表</h3>
            <ul id="playlist"></ul>
            <div class="controls">
                <button class="control-btn" onclick="playPrev()">上一首</button>
                <button class="control-btn" onclick="playNext()">下一首</button>
            </div>
        </div>
    </div>

    <script>
        const API_PROXY = 'https://api.injahow.cn/'
        let playlist = [];
        let currentIndex = -1;
        let searchTimer; // 新增防抖计时器

        // 修改后的搜索事件监听
        document.getElementById('searchInput').addEventListener('input', (e) => {
            debounceSearch(e.target.value);
        });

        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                clearTimeout(searchTimer); // 清除未执行的防抖
                handleSearch(e.target.value.trim());
            }
        });

        // 防抖函数（500ms延迟）
        function debounceSearch(keyword) {
            clearTimeout(searchTimer);
            searchTimer = setTimeout(() => {
                handleSearch(keyword.trim());
            }, 500);
        }

        // 统一搜索处理
        async function handleSearch(keyword) {
            const resultsContainer = document.getElementById('searchResults');
            
            if (!keyword) {
                resultsContainer.innerHTML = '';
                return;
            }

            try {
                const res = await fetch(`${API_PROXY}search?keywords=${encodeURIComponent(keyword)}`);
                const data = await res.json();
                showResults(data.result.songs);
            } catch (error) {
                console.error('搜索失败:', error);
                resultsContainer.innerHTML = '<li style="color: #ff4444;">搜索失败，请稍后重试</li>';
            }
        }

    <div class="container">
        <input type="text" id="searchInput" placeholder="搜索歌曲...">
        <ul id="searchResults"></ul>
        <div id="lyricsContainer"></div>
        <audio id="audioPlayer" controls></audio>

        <!-- 播放列表区域 -->
        <div class="playlist-container">
            <h3 style="color: white; margin-top: 0;">播放列表</h3>
            <ul id="playlist"></ul>
            <div class="controls">
                <button class="control-btn" onclick="playPrev()">上一首</button>
                <button class="control-btn" onclick="playNext()">下一首</button>
            </div>
        </div>
    </div>

    <script>
        // 网易云API代理（可能需要定期更换）
        const API_PROXY = 'https://api.injahow.cn/'
        let playlist = [];     // 播放列表数据
        let currentIndex = -1; // 当前播放索引

        // 搜索功能
        document.getElementById('searchInput').addEventListener('input', async (e) => {
            const keyword = e.target.value.trim()
            if (!keyword) return

            try {
                const res = await fetch(`${API_PROXY}search?keywords=${encodeURIComponent(keyword)}`)
                const data = await res.json()
                showResults(data.result.songs)
            } catch (error) {
                console.error('搜索失败:', error)
            }
        })

        // 显示搜索结果
        function showResults(songs) {
            const resultsContainer = document.getElementById('searchResults')
            resultsContainer.innerHTML = songs.map(song => `
                <li class="song-item" data-id="${song.id}">
                    ${song.name} - ${song.artists.map(a => a.name).join('/')}
                </li>
            `).join('')

            // 添加点击事件
            document.querySelectorAll('.song-item').forEach(item => {
                item.addEventListener('click', () => playSong(item.dataset.id))
            })
        }

        // 播放歌曲（自动加入播放列表）
        async function playSong(id, addToPlaylist = true) {
            try {
                const [detailRes, urlRes] = await Promise.all([
                    fetch(`${API_PROXY}song/detail?ids=${id}`),
                    fetch(`${API_PROXY}song/url?id=${id}`)
                ])
                
                const detail = await detailRes.json()
                const urlData = await urlRes.json()
                
                const songInfo = {
                    id: id,
                    name: detail.songs[0].name,
                    artists: detail.songs[0].ar.map(a => a.name).join('/'),
                    url: urlData.data[0].url
                }

                // 加入播放列表
                if(addToPlaylist) {
                    playlist.push(songInfo)
                    currentIndex = playlist.length - 1
                    updatePlaylistDisplay()
                }

                // 设置音频源
                const audio = document.getElementById('audioPlayer')
                audio.src = songInfo.url
                audio.play()

                // 获取并显示歌词
                const lyricRes = await fetch(`${API_PROXY}lyric?id=${id}`)
                const lyricData = await lyricRes.json()
                showLyrics(parseLyric(lyricData.lrc.lyric))
            } catch (error) {
                console.error('播放失败:', error)
            }
        }

        // 解析歌词
        function parseLyric(lrc) {
            const lines = lrc.split('\n')
            const pattern = /\[(\d{2}):(\d{2})\.(\d{2,3})\]/
            
            return lines.map(line => {
                const matches = pattern.exec(line)
                if (!matches) return null
                
                const min = parseInt(matches[1]) * 60
                const sec = parseInt(matches[2])
                const ms = parseInt(matches[3].padEnd(3, '0')) / 1000
                return {
                    time: min + sec + ms,
                    text: line.replace(pattern, '').trim()
                }
            }).filter(item => item && item.text)
        }

        // 显示歌词
        function showLyrics(lyrics) {
            const container = document.getElementById('lyricsContainer')
            container.innerHTML = lyrics.map(l => `
                <div class="lyric-line" data-time="${l.time}">${l.text}</div>
            `).join('')
        }

        // 歌词同步滚动
        const audio = document.getElementById('audioPlayer')
        const lyricsContainer = document.getElementById('lyricsContainer')
        audio.addEventListener('timeupdate', () => {
            const currentTime = audio.currentTime
            const lines = document.querySelectorAll('.lyric-line')
            
            lines.forEach(line => line.classList.remove('current-lyric'))
            
            for (let i = lines.length - 1; i >= 0; i--) {
                const lineTime = parseFloat(lines[i].dataset.time)
                if (currentTime >= lineTime) {
                    lines[i].classList.add('current-lyric')
                    // 滚动到中间位置
                    const containerHeight = lyricsContainer.offsetHeight
                    const lineTop = lines[i].offsetTop
                    lyricsContainer.scrollTo({
                        top: lineTop - containerHeight/2,
                        behavior: 'smooth'
                    })
                    break
                }
            }
        })

        // 播放列表功能
        function updatePlaylistDisplay() {
            const playlistEl = document.getElementById('playlist')
            playlistEl.innerHTML = playlist.map((song, index) => `
                <li class="playlist-item ${index === currentIndex ? 'current-song' : ''}" 
                    data-index="${index}"
                    onclick="playFromPlaylist(${index})">
                    ${song.name} - ${song.artists}
                </li>
            `).join('')

            // 自动滚动到当前歌曲
            if(currentIndex >= 0) {
                const activeItem = playlistEl.querySelector(`[data-index="${currentIndex}"]`)
                activeItem?.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
            }
        }

        // 从播放列表播放
        function playFromPlaylist(index) {
            currentIndex = index
            const song = playlist[index]
            playSong(song.id, false)
            updatePlaylistDisplay()
        }

        // 播放控制
        function playPrev() {
            if(playlist.length === 0) return
            currentIndex = (currentIndex - 1 + playlist.length) % playlist.length
            playFromPlaylist(currentIndex)
        }

        function playNext() {
            if(playlist.length === 0) return
            currentIndex = (currentIndex + 1) % playlist.length
            playFromPlaylist(currentIndex)
        }

        // 自动播放下一首
        audio.addEventListener('ended', playNext)
    </script>
</body>
</html>